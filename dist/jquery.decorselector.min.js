/*! jquery.decorselector.js (git@github.com:oosugi20/jquery.decorselector.js.git)
* 
 * lastupdate: 2014-05-11
 * version: 0.2.6
 * author: Makoto OOSUGI <oosugi20@gmail.com>
 * License: MIT
 */
!function(a){"use script";var b,c="Decorselector",d="decorselector";b=function(b,c){this.el=b,this.$el=a(b),this.options=a.extend({},c)},function(b){b.init=function(){var b=this;this._prepareElms(),this._createVirtualList(),this.controllDisabled(),this._eventify(),this._updateSelected(),this.$currentSelected=this.$selected,this.width=function(){var c=0;return b.$item.each(function(){c=Math.max(c,a(this).width())}),c}(),this.$result.width(this.width),this.$list.find(".ui-decorselector-label").width(this.width),this.$list.hide()},b._prepareElms=function(){this.$option=this.$el.find("option"),this.$wrap=this.$el.wrap('<div class="ui-decorselector"/>').parent(),this.$results=a('<a href="#" class="ui-decorselector-results"/>'),this.$result=a('<span class="ui-decorselector-result"/>').appendTo(this.$results),this.$arrow=a('<span class="ui-decorselector-arrow">â†“</span>').appendTo(this.$results),this.$results.appendTo(this.$wrap)},b._createVirtualList=function(){var b=!!this.$el.has("optgroup").length,c='<ul class="ui-decorselector-list">';b?this.$el.find("optgroup").each(function(){var b=a(this);c+='<li class="ui-decorselector-group">',c+='<dfn class="ui-decorselector-label">'+b.attr("label")+"</dfn>",c+='<ul class="ui-decorselector-groupitems">',b.find("option").each(function(){var b=a(this);c+='<li class="ui-decorselector-item" data-decorselector-value="'+b.val()+'"><a href="#">'+b.text()+"</a></li>"}),c+="</ul></li>"}):(this.$el.find("option").each(function(){var b=a(this);c+='<li class="ui-decorselector-item" data-decorselector-value="'+b.val()+'"><a href="#">'+b.text()+"</a></li>"}),c+="</ul>"),this.$list=a(c).appendTo(this.$wrap),this.$item=this.$list.find(".ui-decorselector-item")},b.controllDisabled=function(){this.$el.prop("disabled")?this.$wrap.addClass("disabled"):this.$wrap.removeClass("disabled")},b._eventify=function(){var b=this;this.$wrap.on("click",".ui-decorselector-results",function(a){a.preventDefault(),b.$el.prop("disabled")||b._toggleList()}),this.$wrap.on("click",".ui-decorselector-item a",function(c){var d=a(this).parent();c.preventDefault(),b.$option.attr("selected",!1),b.$option.filter('[value="'+d.attr("data-decorselector-value")+'"]').attr("selected",!0),b._updateSelected(),b.$currentSelected=b.$selected,b._closeList(),b.$el.trigger("change")}),this.$wrap.on("keydown","a",function(a){var c=a.keyCode||a.which,d={left:37,up:38,right:39,down:40};switch(c){case d.left:break;case d.up:a.preventDefault(),b.$list.is(":hidden")?b._openList():b.$selected.prev().length&&(b.$selected.attr("selected",!1),b.$selected.prev().attr("selected",!0),b._updateSelected());break;case d.right:break;case d.down:a.preventDefault(),b.$list.is(":hidden")?b._openList():b.$selected.next().length&&(b.$selected.attr("selected",!1),b.$selected.next().attr("selected",!0),b._updateSelected());break;case 27:b.$list.is(":visible")&&(b.$selected.attr("selected",!1),b.$currentSelected.attr("selected",!0),b._updateSelected(),b._closeList());break;case 9:b.$list.is(":visible")&&(a.preventDefault(),b.$selected.attr("selected",!1),b.$currentSelected.attr("selected",!0),b._updateSelected(),b._closeList());break;case 13:a.preventDefault(),b.$list.is(":visible")&&(b._closeList(),b.$currentSelected=b.$selected,b.$el.trigger("change"))}}),this.$results.on("focus blur",function(a){switch(a.type){case"focus":b.$wrap.removeClass("blur"),b.$wrap.addClass("focus");break;case"blur":b.$wrap.removeClass("focus"),b.$wrap.addClass("blur")}}),this.$wrap.on("click",function(a){a.stopPropagation()}),a(document).on("click",function(){b.$list.is(":visible")&&(b.$list.hide(),b.$wrap.removeClass("opened"))})},b._updateSelected=function(){this.$selected=this.$option.filter(":selected"),this._selectedText=this.$selected.text(),this._selectedValue=this.$el.val(),this.$item.removeClass("selected"),this.$item.filter('[data-decorselector-value="'+this._selectedValue+'"]').addClass("selected").find("a"),this.$result.text(this._selectedText),this._selectedValue?this.$wrap.addClass("selected"):this.$wrap.removeClass("selected")},b._openList=function(){this.$list.show(),this.$results.focus(),this.$wrap.addClass("opened")},b._closeList=function(){this.$list.hide(),this.$results.focus(),this.$wrap.removeClass("opened")},b._toggleList=function(a){a&&a.preventDefault(),this.$list.is(":hidden")?this._openList():this._closeList()}}(b.prototype),a.fn[d]=function(c){return this.each(function(){var e;a.data(this,d)||(e=new b(this,c),a.data(this,d,e),e.init())})},a[c]=b}(jQuery,this);